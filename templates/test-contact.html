{% extends "base.html" %}

{% block title %}Test Contact - Esra Innovate{% endblock %}

{% block head %}
<!-- SEO blocking meta tags to prevent search engine indexing -->
<meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
<meta name="googlebot" content="noindex, nofollow">
<meta name="bingbot" content="noindex, nofollow">
<link rel="stylesheet" href="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/themes/df-messenger-default.css">
{% endblock %}

{% block content %}
<!-- MATTR-style hero section -->
<div class="business-services-hero">
    {% set active_page = 'contact' %}
    {% include "menu.html" %}
    
    <div class="container">
        <div class="hero-content">
            <h1>Test Contact Page</h1>
            <p>This is a test page for the chat functionality. This page is not indexed by search engines.</p>
        </div>
    </div>
</div>

<!-- Contact Form Section -->
<section class="solutions-overview" style="padding: 60px 0 40px 0;">
    <div class="container">
        <div class="section-header" style="margin-bottom: 40px;">
            <h2>Test Contact Form</h2>
            <p class="section-subtitle">This is a test version of the contact form with chat functionality enabled for testing purposes.</p>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="contact-form-container" style="background: white; border-radius: 12px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #e9ecef;">
                    <div class="text-center mb-4">
                        <h3 style="color: #00204a; margin-bottom: 10px;">Test Contact Form</h3>
                        <p style="color: #666;">This form includes the chat bot for testing</p>
                    </div>
                    
                    <div class="google-form-container" style="display: flex; justify-content: center;">
                        <iframe 
                            src="https://docs.google.com/forms/d/e/1FAIpQLSf8EpfLzJsKRESGhdVeXG_OLS2SG6sN36Z_e28K0aGPzrVE5Q/viewform?embedded=true" 
                            width="100%" 
                            height="750" 
                            frameborder="0" 
                            marginheight="0" 
                            marginwidth="0"
                            style="max-width: 640px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            Loading…
                        </iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Contact Methods Section - Compact Design -->
<section class="why-choose-section" style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); padding: 60px 0;">
    <div class="container">
        <div class="section-header" style="margin-bottom: 40px;">
            <h2>Test Contact Methods</h2>
            <p class="section-subtitle">Test contact methods with chat functionality enabled.</p>
        </div>
        
        <div class="row">
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="feature-card" style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: 100%; text-align: center; transition: all 0.3s ease; border: 1px solid #e9ecef;">
                    <div class="feature-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, #00bbf0, #007fa4); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                        <img src="{{ url_for('static', filename='images/_phoneai.png') }}" alt="" style="width: 35px; height: 35px; object-fit: contain; filter: brightness(0) invert(1);">
                    </div>
                    <h5 style="color: #00204a; font-weight: 600; margin-bottom: 15px; font-size: 1.2rem;">Phone</h5>
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 20px;">For quick questions or immediate assistance, call us directly. We typically respond within the same day during business hours.</p>
                    <a href="tel:+64212381611" class="btn1" style="margin-top: 0; display: inline-block; padding: 12px 25px; font-size: 0.9rem;">Call Us Directly</a>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="feature-card" style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: 100%; text-align: center; transition: all 0.3s ease; border: 1px solid #e9ecef;">
                    <div class="feature-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, #00bbf0, #007fa4); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                        <img src="{{ url_for('static', filename='images/ai_powered_writing.png') }}" alt="" style="width: 35px; height: 35px; object-fit: contain; filter: brightness(0) invert(1);">
                    </div>
                    <h5 style="color: #00204a; font-weight: 600; margin-bottom: 15px; font-size: 1.2rem;">Email</h5>
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 20px;">Send us a detailed email for comprehensive inquiries, project proposals, or to schedule a consultation.</p>
                    <a href="mailto:info@esra.co.nz?subject=AI%20Services%20Inquiry" class="btn1" style="margin-top: 0; display: inline-block; padding: 12px 25px; font-size: 0.9rem;">info@esra.co.nz</a>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="feature-card" style="background: white; border-radius: 12px; padding: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: 100%; text-align: center; transition: all 0.3s ease; border: 1px solid #e9ecef;">
                    <div class="feature-icon" style="width: 70px; height: 70px; background: linear-gradient(135deg, #00bbf0, #007fa4); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
                        <img src="{{ url_for('static', filename='images/ai_power_video.png') }}" alt="" style="width: 35px; height: 35px; object-fit: contain; filter: brightness(0) invert(1);">
                    </div>
                    <h5 style="color: #00204a; font-weight: 600; margin-bottom: 15px; font-size: 1.2rem;">Chat Bot</h5>
                    <p style="color: #666; font-size: 0.9rem; line-height: 1.5; margin-bottom: 20px;">Use our AI chat bot for instant answers to your questions. The chat widget should be visible on this test page.</p>
                    <div class="btn1" style="margin-top: 0; display: inline-block; padding: 12px 25px; font-size: 0.9rem; background: #00bbf0; color: white; border-radius: 6px; text-decoration: none;">Chat Bot Active</div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block footer %}
  {% set footer_title = 'Test Page Footer' %}
  {% set footer_content = '
  <p>This is a test page for the chat functionality. The chat bot should be visible and functional on this page.</p>
  <p>This page is not indexed by search engines.</p>
  ' %}
  {% include "includes/footer.html" %}
{% endblock %}

{% block scripts %}
<!-- Google Dialogflow Chat Bot -->
<df-messenger
  location="australia-southeast1"
  project-id="esra-website"
  agent-id="c99e4dd7-b110-4c76-8f5d-64b473c595fd"
  language-code="en"
  welcome-event="custom.welcome"
  max-query-length="-1">
  <df-messenger-chat
    chat-title="Esra Innovate Agent">
  </df-messenger-chat>
</df-messenger>

<style>
  df-messenger {
    z-index: 999;
    position: fixed;
    --df-messenger-font-color: #000;
    --df-messenger-font-family: Google Sans;
    --df-messenger-chat-background: #f3f6fc;
    --df-messenger-message-user-background: #d3e3fd;
    --df-messenger-message-bot-background: #fff;
    --df-messenger-button-titlebar-color: #00204a;
    --df-messenger-button-titlebar-font-color: #fff;
    --df-messenger-chat-titlebar-color: #00204a;
    --df-messenger-chat-titlebar-font-color: #fff;
    bottom: 0;
    right: 0;
    top: 50vh;
    width: 50vw;
    min-width: 200px;
    max-width: 300px;
    height: 50vh;
    box-shadow: -5px 0 20px rgba(0,0,0,0.1);
    border-left: 3px solid #00bbf0;
    transition: all 0.3s ease;
  }
  
  df-messenger.minimized {
    top: calc(100vh - 60px);
    height: 60px;
  }
  
  /* Make chat more visible on mobile */
  @media (max-width: 768px) {
    df-messenger {
      width: 100vw;
      min-width: 100vw;
      max-width: 100vw;
      top: 50vh;
      height: 50vh;
    }
    
    df-messenger.minimized {
      top: calc(100vh - 60px);
      height: 60px;
    }
  }
</style>

<script>
// Add minimize functionality with more reliable approach
document.addEventListener('DOMContentLoaded', function() {
  let minimizeBtn = null;
  
  function createMinimizeButton() {
    if (minimizeBtn) return;
    
    minimizeBtn = document.createElement('button');
    minimizeBtn.innerHTML = '−';
    minimizeBtn.id = 'chat-minimize-btn';
    minimizeBtn.title = 'Minimize Chat';
    minimizeBtn.style.cssText = `
      position: fixed;
      top: 51vh;
      right: 15px;
      background: #00bbf0;
      color: white;
      border: none;
      border-radius: 50%;
      width: 35px;
      height: 35px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      border: 2px solid white;
    `;
    
    // Add to body immediately
    document.body.appendChild(minimizeBtn);
    
    // Add click functionality
    minimizeBtn.addEventListener('click', function() {
      const dfMessenger = document.querySelector('df-messenger');
      if (dfMessenger) {
        dfMessenger.classList.toggle('minimized');
        minimizeBtn.innerHTML = dfMessenger.classList.contains('minimized') ? '+' : '−';
        minimizeBtn.title = dfMessenger.classList.contains('minimized') ? 'Expand Chat' : 'Minimize Chat';
        
        // Update button position
        if (dfMessenger.classList.contains('minimized')) {
          minimizeBtn.style.top = 'calc(100vh - 80px)';
        } else {
          minimizeBtn.style.top = '50vh';
        }
      }
    });
    
    // Add hover effects
    minimizeBtn.addEventListener('mouseenter', function() {
      this.style.background = '#007fa4';
      this.style.transform = 'scale(1.1)';
    });
    
    minimizeBtn.addEventListener('mouseleave', function() {
      this.style.background = '#00bbf0';
      this.style.transform = 'scale(1)';
    });
  }
  
  // Create button immediately
  createMinimizeButton();
  
  // Also try to add it when df-messenger loads
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList') {
        const dfMessenger = document.querySelector('df-messenger');
        if (dfMessenger && !minimizeBtn) {
          createMinimizeButton();
        }
      }
    });
  });
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
  
  // Fallback: check periodically
  setTimeout(function() {
    if (!minimizeBtn) {
      createMinimizeButton();
    }
  }, 1000);
});
</script>

<script src="https://www.gstatic.com/dialogflow-console/fast/df-messenger/prod/v1/df-messenger.js"></script>
{% endblock %}
